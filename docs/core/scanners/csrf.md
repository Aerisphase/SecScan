# Сканер CSRF

## Обзор
Модуль `csrf.py` реализует функциональность сканирования на наличие защиты от межсайтовой подделки запросов (CSRF). Сканер проверяет наличие CSRF-токенов и защитных заголовков в ответах сервера.

## Основные компоненты

### Класс CSRFScanner
Основной класс для сканирования CSRF-защиты.

#### Методы:
- `__init__(self, session: Session)`
  - Инициализация сканера
  - Параметры:
    - `session`: Сессия requests для выполнения запросов

- `scan(self, url: str) -> Dict[str, Optional[bool]]`
  - Проверка наличия CSRF-защиты
  - Параметры:
    - `url`: URL для проверки
  - Возвращает словарь с результатами проверки

## Формат результатов

Результаты проверки возвращаются в виде словаря:

```python
{
    'csrf_protected': bool,  # Наличие CSRF-защиты
    'token_found': bool,     # Наличие CSRF-токена
    'error': str            # Сообщение об ошибке (если есть)
}
```

## Проверяемые параметры

### CSRF-токены
Сканер ищет следующие типы токенов в HTML:
- `csrf_token`
- `csrfmiddlewaretoken`
- `authenticity_token`

### Защитные заголовки
Сканер проверяет наличие следующих заголовков:
- `X-CSRF-Protection: 1`
- `SameSite=Strict` в заголовке `Set-Cookie`

## Пример использования

```python
from core.scanners.csrf import CSRFScanner
import requests

# Создание сессии
session = requests.Session()

# Создание сканера
scanner = CSRFScanner(session)

# Проверка URL
url = 'https://example.com/profile'
results = scanner.scan(url)

# Обработка результатов
if results['error']:
    print(f"Ошибка при проверке: {results['error']}")
else:
    if results['csrf_protected']:
        print("CSRF-защита обнаружена")
    else:
        print("CSRF-защита отсутствует")
        
    if results['token_found']:
        print("CSRF-токен найден")
    else:
        print("CSRF-токен не найден")
```

## Особенности реализации

1. **Проверка токенов**
   - Поиск в HTML-коде
   - Проверка различных форматов
   - Учет регистра символов

2. **Проверка заголовков**
   - Анализ заголовков ответа
   - Проверка значений
   - Поддержка различных форматов

3. **Обработка ошибок**
   - Логирование ошибок
   - Возврат None для неопределенных результатов
   - Сохранение сообщений об ошибках

## Рекомендации по использованию

1. Настройте сессию перед использованием:
   - Установите User-Agent
   - Настройте таймауты
   - Добавьте необходимые заголовки

2. Проверяйте все формы и эндпоинты:
   - Страницы входа
   - Формы изменения данных
   - API-эндпоинты

3. Учитывайте ограничения сканера:
   - Не все типы CSRF-токенов могут быть обнаружены
   - Некоторые методы защиты могут быть пропущены
   - Возможны ложные срабатывания

4. Используйте результаты для:
   - Оценки уровня безопасности
   - Планирования улучшений
   - Документирования уязвимостей 